#!/bin/bash

# run systemctl commands

RPI_SYSTEMCTL_CMDS="${RPI_SYSTEMCTL_CMDS:=""}"
RPI_SYSTEMCTL_RUN_ON_BOOT="${RPI_SYSTEMCTL_RUN_ON_BOOT:=false}"

function rpi_systemctl_prerun() {
    [[ -n "${RPI_SYSTEMCTL_CMDS}" ]] || return 1
    return 0
}

function rpi_systemctl_run() {
    # choose runner
    local runner
    if [[ "${RPI_SYSTEMCTL_RUN_ON_BOOT}" == "true" ]] ; then
        runner="run_on_first_boot"
    else
        runner="run_on_first_login"
    fi

    for cmd in "${RPI_SYSTEMCTL_CMDS[@]}" ; do
        "${runner}" "sudo systemctl ${cmd}" || error "install systemctl ${cmd}"
    done
}

function rpi_systemctl_description() {
    echo "run systemctl commands once"
}

function rpi_systemctl_help_vars() {
    local vars=(
        "RPI_SYSTEMCTL_CMDS|array of systemctl commands|${RPI_SYSTEMCTL_CMDS}"
        "RPI_SYSTEMCTL_RUN_ON_BOOT|run on first boot instead first login|${RPI_SYSTEMCTL_RUN_ON_BOOT}"
    )
    help_for_vars "${vars[@]}"
}
